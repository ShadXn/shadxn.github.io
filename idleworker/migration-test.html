<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Test Setup</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .code { background: #f8f9fa; border: 1px solid #e9ecef; padding: 10px; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>🧪 Migration Test Setup</h1>
    
    <div class="warning">
        <strong>⚠️ Warning:</strong> This will clear your current game data and set up test legacy data for migration testing.
    </div>
    
    <h2>Test Scenarios</h2>
    
    <button class="button" onclick="setupFullMigrationTest()">
        🔄 Setup Full Migration Test (Workers + Items)
    </button>
    
    <button class="button" onclick="setupItemsOnlyTest()">
        📦 Setup Items Migration Only
    </button>
    
    <button class="button" onclick="setupWorkersOnlyTest()">
        👥 Setup Workers Migration Only
    </button>
    
    <button class="button" onclick="clearAllData()">
        🗑️ Clear All Data
    </button>
    
    <button class="button" onclick="goToGame()">
        🎮 Go to Game (Trigger Migration)
    </button>
    
    <div id="results"></div>
    
    <h2>Manual Console Commands</h2>
    <div class="code">
        <strong>To set up test data manually:</strong><br>
        localStorage.setItem('idle_resources', JSON.stringify({gold: 472913, bronze_axe: 6, recipe_bronze: 113}));<br>
        localStorage.setItem('idle_workers', '3');<br>
        <strong>Then refresh the main game page.</strong>
    </div>

    <script>
        function showResult(message, isSuccess = true) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="${isSuccess ? 'success' : 'warning'}">${message}</div>`;
        }
        
        function setupFullMigrationTest() {
            // Clear existing data
            ['idle_items', 'idle_workers_owned', 'idle_assignments', 'idle_worker_data', 'job_completion_count'].forEach(key => {
                localStorage.removeItem(key);
            });
            
            // Set up legacy data
            const legacyItems = {
                gold: 472913, fish: 1, cooked_fish: 16089, logs: 24417, ore: 25693, ingot: 48881,
                fire_wood: 201249, refined_wood: 80107, bronze_armor: 1, bronze_axe: 6, bronze_boots: 6,
                bronze_hammer: 2, bronze_pickaxe: 6, bronze_rod: 6, bronze_shield: 1, bronze_sword: 1,
                iron_armor: 1, iron_boots: 1, iron_shield: 1, iron_sword: 1, black_armor: 1,
                black_shield: 1, black_sword: 1, recipe_bronze: 113, recipe_black: 103, recipe_iron: 193, recipe_steel: 100
            };
            
            localStorage.setItem('idle_resources', JSON.stringify(legacyItems));
            localStorage.setItem('idle_workers', '3');
            
            showResult(`✅ Full migration test setup complete!<br>
                       📦 ${Object.keys(legacyItems).length} legacy items<br>
                       👥 3 legacy workers<br>
                       🔄 <strong>Click "Go to Game" to trigger migration</strong>`);
        }
        
        function setupItemsOnlyTest() {
            ['idle_items'].forEach(key => localStorage.removeItem(key));
            
            const legacyItems = {
                gold: 100000, logs: 500, bronze_axe: 3, iron_sword: 1, recipe_bronze: 50
            };
            
            localStorage.setItem('idle_resources', JSON.stringify(legacyItems));
            localStorage.removeItem('idle_workers'); // Ensure no worker migration
            
            showResult(`✅ Items-only migration test setup!<br>
                       📦 ${Object.keys(legacyItems).length} legacy items<br>
                       🔄 <strong>Click "Go to Game" to trigger migration</strong>`);
        }
        
        function setupWorkersOnlyTest() {
            ['idle_workers_owned', 'idle_assignments', 'idle_worker_data'].forEach(key => localStorage.removeItem(key));
            
            localStorage.setItem('idle_workers', '2');
            localStorage.removeItem('idle_resources'); // Ensure no items migration
            
            showResult(`✅ Workers-only migration test setup!<br>
                       👥 2 legacy workers<br>
                       🔄 <strong>Click "Go to Game" to trigger migration</strong>`);
        }
        
        function clearAllData() {
            ['idle_items', 'idle_workers_owned', 'idle_assignments', 'idle_worker_data', 
             'job_completion_count', 'idle_resources', 'idle_workers'].forEach(key => {
                localStorage.removeItem(key);
            });
            showResult('🗑️ All test data cleared!');
        }
        
        function goToGame() {
            window.open('/', '_blank');
        }
    </script>
</body>
</html>
